<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rianne Nienke Visscher (Student ID: 100514861), Frederick Pena Sims (Student ID: 100506380),Alexandra Salo (Student ID: 100508332), Mikaela DeSmedt (Student ID: 100481838), Alicia Talavera Marcos (Student ID: 100508665)">

<title>Group Task</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="group_files/libs/clipboard/clipboard.min.js"></script>
<script src="group_files/libs/quarto-html/quarto.js"></script>
<script src="group_files/libs/quarto-html/popper.min.js"></script>
<script src="group_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="group_files/libs/quarto-html/anchor.min.js"></script>
<link href="group_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="group_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="group_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="group_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="group_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#required-packages" id="toc-required-packages" class="nav-link active" data-scroll-target="#required-packages">Required packages</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data cleaning</a></li>
  </ul></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a>
  <ul class="collapse">
  <li><a href="#q1-how-is-the-vote-of-national-parties-psoe-pp-vox-cs-mp-up---iu-distributed-against-regional-or-nationalist-parties" id="toc-q1-how-is-the-vote-of-national-parties-psoe-pp-vox-cs-mp-up---iu-distributed-against-regional-or-nationalist-parties" class="nav-link" data-scroll-target="#q1-how-is-the-vote-of-national-parties-psoe-pp-vox-cs-mp-up---iu-distributed-against-regional-or-nationalist-parties">Q1 How is the vote of national parties (PSOE, PP, VOX, CS, MP, UP - IU) distributed against regional or nationalist parties?</a></li>
  <li><a href="#q2-which-party-was-the-winner-in-the-municipalities-with-more-than-100000-habitants-census-in-each-of-the-elections" id="toc-q2-which-party-was-the-winner-in-the-municipalities-with-more-than-100000-habitants-census-in-each-of-the-elections" class="nav-link" data-scroll-target="#q2-which-party-was-the-winner-in-the-municipalities-with-more-than-100000-habitants-census-in-each-of-the-elections">Q2 Which party was the winner in the municipalities with more than 100,000 habitants (census) in each of the elections?</a></li>
  <li><a href="#q3-which-party-was-the-second-when-the-first-was-the-psoe-and-when-the-first-was-the-pp" id="toc-q3-which-party-was-the-second-when-the-first-was-the-psoe-and-when-the-first-was-the-pp" class="nav-link" data-scroll-target="#q3-which-party-was-the-second-when-the-first-was-the-psoe-and-when-the-first-was-the-pp">Q3 Which party was the second when the first was the PSOE? And when the first was the PP?</a></li>
  <li><a href="#q4-who-benefits-from-low-turnout" id="toc-q4-who-benefits-from-low-turnout" class="nav-link" data-scroll-target="#q4-who-benefits-from-low-turnout">Q4 Who benefits from low turnout?</a></li>
  <li><a href="#q5-how-to-analyze-the-relationship-between-census-and-vote-is-it-true-that-certain-parties-win-in-rural-areas" id="toc-q5-how-to-analyze-the-relationship-between-census-and-vote-is-it-true-that-certain-parties-win-in-rural-areas" class="nav-link" data-scroll-target="#q5-how-to-analyze-the-relationship-between-census-and-vote-is-it-true-that-certain-parties-win-in-rural-areas">Q5 How to analyze the relationship between census and vote? Is it true that certain parties win in rural areas?</a></li>
  <li><a href="#q6-how-to-calibrate-the-error-of-the-polls-remember-that-the-polls-are-voting-intentions-at-national-level" id="toc-q6-how-to-calibrate-the-error-of-the-polls-remember-that-the-polls-are-voting-intentions-at-national-level" class="nav-link" data-scroll-target="#q6-how-to-calibrate-the-error-of-the-polls-remember-that-the-polls-are-voting-intentions-at-national-level">Q6 How to calibrate the error of the polls (remember that the polls are voting intentions at national level)?</a></li>
  <li><a href="#q7-in-which-election-were-the-polls-most-wrong" id="toc-q7-in-which-election-were-the-polls-most-wrong" class="nav-link" data-scroll-target="#q7-in-which-election-were-the-polls-most-wrong">Q7 In which election were the polls most wrong?</a></li>
  <li><a href="#q8-how-were-the-polls-wrong-in-national-parties-psoe-pp-vox-cs-mp-up---iu" id="toc-q8-how-were-the-polls-wrong-in-national-parties-psoe-pp-vox-cs-mp-up---iu" class="nav-link" data-scroll-target="#q8-how-were-the-polls-wrong-in-national-parties-psoe-pp-vox-cs-mp-up---iu">Q8 How were the polls wrong in national parties (PSOE, PP, VOX, CS, MP, UP - IU)?</a></li>
  <li><a href="#q9-which-polling-houses-got-it-right-the-most-and-which-ones-deviated-the-most-from-the-results" id="toc-q9-which-polling-houses-got-it-right-the-most-and-which-ones-deviated-the-most-from-the-results" class="nav-link" data-scroll-target="#q9-which-polling-houses-got-it-right-the-most-and-which-ones-deviated-the-most-from-the-results">Q9 Which polling houses got it right the most and which ones deviated the most from the results?</a></li>
  </ul></li>
  <li><a href="#additional-insights" id="toc-additional-insights" class="nav-link" data-scroll-target="#additional-insights">Additional insights</a>
  <ul class="collapse">
  <li><a href="#how-did-the-voter-turnout-change-in-the-two-elections-in-2019" id="toc-how-did-the-voter-turnout-change-in-the-two-elections-in-2019" class="nav-link" data-scroll-target="#how-did-the-voter-turnout-change-in-the-two-elections-in-2019">How did the voter turnout change in the two elections in 2019?</a></li>
  <li><a href="#who-won-which-municipality-and-how-did-it-change-over-the-years" id="toc-who-won-which-municipality-and-how-did-it-change-over-the-years" class="nav-link" data-scroll-target="#who-won-which-municipality-and-how-did-it-change-over-the-years">Who won which municipality and how did it change over the years?</a></li>
  <li><a href="#from-a-two-party-system-to-a-multi-party-system" id="toc-from-a-two-party-system-to-a-multi-party-system" class="nav-link" data-scroll-target="#from-a-two-party-system-to-a-multi-party-system">From a two-party system to a multi-party system</a></li>
  <li><a href="#who-uses-which-polling-provider" id="toc-who-uses-which-polling-provider" class="nav-link" data-scroll-target="#who-uses-which-polling-provider">Who uses which polling provider?</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Group Task</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rianne Nienke Visscher (Student ID: 100514861), Frederick Pena Sims (Student ID: 100506380),Alexandra Salo (Student ID: 100508332), Mikaela DeSmedt (Student ID: 100481838), Alicia Talavera Marcos (Student ID: 100508665) </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="required-packages" class="level2">
<h2 class="anchored" data-anchor-id="required-packages">Required packages</h2>
<blockquote class="blockquote">
<p>Insert in the lower chunk the packages you will need</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CGPfunctions)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapSpain)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>The practice will be based on the <strong>electoral data archives</strong> that we have already worked on, compiling data on elections to the Spanish Congress of Deputies from 2008 to the present.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>election_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"datos_elecciones_brutos.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>cod_mun <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"cod_mun.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>surveys <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"historical_surveys.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>abbrev <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"siglas.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data will be as follows:</p>
<ul>
<li><p><code>poll_data</code>: file with election data for Congress from 2018 to the last ones in 2019.</p></li>
<li><p><code>cod_mun</code>: file with the codes and names of each municipality</p></li>
<li><p><code>abbrev</code>: acronyms and names associated with each party</p></li>
<li><p><code>surveys</code>: table of electoral polls since 1982. Some of the variables are the following:</p></li>
</ul>
<p>You must obligatorily answer the following questions (plus those that you consider analyzing to distinguish yourself from the rest of the teams, either numerically and/or graphically)</p>
<ul>
<li>How is the vote of national parties (PSOE, PP, VOX, CS, MP, UP - IU) distributed against regional or nationalist parties?</li>
<li>Which party was the winner in the municipalities with more than 100,000 habitants (census) in each of the elections?</li>
<li>Which party was the second when the first was the PSOE? And when the first was the PP?</li>
<li>Who benefits from low turnout?</li>
<li>How to analyze the relationship between census and vote? Is it true that certain parties win in rural areas?</li>
<li>How to calibrate the error of the polls (remember that the polls are voting intentions at national level)?</li>
<li>In which election were the polls most wrong?</li>
<li>How were the polls wrong in national parties (PSOE, PP, VOX, CS, MP, UP - IU)?</li>
<li>Which polling houses got it right the most and which ones deviated the most from the results?</li>
</ul>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning">Data cleaning</h3>
<p>First, we clean data according to the principles of tidy data. These data frames are the basis for our subsequent operations.</p>
<section id="election-data" class="level4">
<h4 class="anchored" data-anchor-id="election-data">Election data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>election_data_clean <span class="ot">&lt;-</span> election_data <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span><span class="st">"BERDEAK-LOS VERDES"</span><span class="sc">:</span><span class="st">"COALICIÓN POR MELILLA"</span>, <span class="co">#Pivoting to make tidy data</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"party"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"votes"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>election_data_clean<span class="ot">&lt;-</span>election_data_clean<span class="sc">|&gt;</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_elec =</span> <span class="fu">make_date</span>(anno, mes)) <span class="sc">|&gt;</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>tipo_eleccion, <span class="sc">-</span>codigo_distrito_electoral) <span class="sc">|&gt;</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">votes =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(votes), <span class="dv">0</span>, votes)) <span class="co">#changing all NA values to 0, as we expect that the data set misinterprets 0s as NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="abbrev-data" class="level4">
<h4 class="anchored" data-anchor-id="abbrev-data">Abbrev data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>distinct_parties <span class="ot">&lt;-</span> election_data_clean <span class="sc">|&gt;</span>  </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(party)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine datasets as there are parties in election_data not present in </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>abbrev_test <span class="ot">&lt;-</span> abbrev <span class="sc">|&gt;</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(distinct_parties, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"denominacion"</span> <span class="ot">=</span> <span class="st">"party"</span>)) </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#abbrev_test &lt;- abbrev |&gt; </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#full_join(distinct_parties, by = c("denominacion" = "party")) |&gt; </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(is.na(siglas))</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a new column with the collected parties</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a> abbrev_collect<span class="ot">&lt;-</span>abbrev_test <span class="sc">|&gt;</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">party_collect =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(siglas, <span class="st">"PSOE"</span>) <span class="sc">|</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(siglas, <span class="st">"P.S.O.E"</span>) <span class="sc">|</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(siglas, <span class="st">"psoe"</span>) <span class="sc">|</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(denominacion, <span class="st">"PARTIDO SOCIALISTA"</span>) <span class="sc">|</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(denominacion, <span class="st">"PSOE"</span>) <span class="sc">|</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(denominacion, <span class="st">"P.S.O.E."</span>) <span class="sc">~</span> <span class="st">"PSOE"</span>, <span class="co"># PARTIDO SOCIALISTA OBRERO ESPAÑOL</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(denominacion, <span class="st">"CONVERGENCIA I UNIO"</span>) <span class="sc">~</span> <span class="st">"CU"</span>, <span class="co"># CONVERGÈNCIA I UNIÓ</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(siglas, <span class="st">"PP"</span>) <span class="sc">|</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(denominacion, <span class="st">"PARTIDO POPULAR"</span>)  <span class="sc">~</span> <span class="st">"PP"</span>, <span class="co"># PARTIDO POPULAR</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(denominacion, <span class="st">"CIUDADANOS-"</span>) <span class="sc">~</span> <span class="st">"CS"</span>, <span class="co">#CIUDADANOS </span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(denominacion, <span class="st">"UNIDAS"</span>)<span class="sc">|</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(siglas, <span class="st">"PODEMOS"</span>)<span class="sc">|</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"VERDES"</span>)<span class="sc">|</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"PODEM"</span>)<span class="sc">|</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"EZKER"</span>) <span class="sc">|</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(siglas, <span class="st">"IU"</span>)<span class="sc">~</span> <span class="st">"UP_IU"</span>, <span class="co">#UNIDAS PODEMOS - IU </span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(denominacion, <span class="st">"BILDU"</span>)<span class="sc">|</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(siglas, <span class="st">"EH"</span>)<span class="sc">|</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"SORTU"</span>)<span class="sc">|</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"ALKARTASUNA"</span>)<span class="sc">|</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"ARALAR"</span>) <span class="sc">|</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"ALTERNATIBA"</span>) <span class="sc">~</span> <span class="st">"EH_BILDU"</span>, <span class="co"># EH - BILDU </span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"VASCO"</span>) <span class="sc">~</span> <span class="st">"PNV"</span>, <span class="co"># PARTIDO NACIONALISTA VASCO</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(siglas, <span class="st">"BNG"</span>) <span class="sc">|</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"GALLEG"</span>) <span class="sc">|</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"GALICIA"</span>) <span class="sc">|</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"GALEGUISTA"</span>)<span class="sc">|</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"GALEG"</span>) <span class="sc">|</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"GALIZ"</span>) <span class="sc">~</span> <span class="st">"BNG"</span>, <span class="co"># BLOQUE NACIONALISTA GALLEGO</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(siglas, <span class="st">"VOX"</span>) <span class="sc">~</span> <span class="st">"VOX"</span>, <span class="co"># VOX</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(siglas, <span class="st">"PAÍS"</span>) <span class="sc">~</span> <span class="st">"MP"</span>, <span class="co"># MÁS PAÍS</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(siglas, <span class="st">"COMPROMÍS"</span>)  <span class="sc">~</span> <span class="st">"CP"</span>, <span class="co"># COMPROMÍS</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(siglas, <span class="st">"ERC"</span>) <span class="sc">|</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(denominacion, <span class="st">"CATALUNYA SÍ"</span>) <span class="sc">~</span> <span class="st">"ERC"</span>, <span class="co"># ESQUERRA REPUBLICANA DE CATALUNYA</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"OTHER"</span>))<span class="sc">|&gt;</span> </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(denominacion, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="survey-data" class="level4">
<h4 class="anchored" data-anchor-id="survey-data">Survey data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>survey_clean <span class="ot">&lt;-</span> surveys <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(<span class="fu">year</span>(date_elec) <span class="sc">&gt;=</span> <span class="dv">2018</span>) <span class="sc">|&gt;</span> <span class="co">#Filtering only years &gt;2018</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(exit_poll <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> <span class="co"># Only keeping non exit polls</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(size <span class="sc">&gt;</span><span class="dv">750</span><span class="sc">|</span> size <span class="sc">!=</span> <span class="cn">NA</span>) <span class="sc">|&gt;</span> <span class="co">#Only keeping cases with a size ,larger than 750 or are bot NA</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">field_days =</span> field_date_to <span class="sc">-</span> field_date_from) <span class="sc">|&gt;</span> <span class="co">#New column to count the number of field days</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">relocate</span>(field_days, <span class="at">.after =</span> field_date_to) <span class="sc">|&gt;</span> <span class="co">#Relocating the field_days column</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(field_days<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="co">#Filtering cases with field days &gt;0</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span><span class="st">"UCD"</span><span class="sc">:</span><span class="st">"EV"</span>, <span class="co">#Pivoting to make tidy data</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"party"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"vote_int"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vote_int =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(vote_int), <span class="dv">0</span>, vote_int))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="joining-tables" class="level4">
<h4 class="anchored" data-anchor-id="joining-tables">Joining tables</h4>
<p>Now, we join tables. The abbreviations are joined to the election data and the survey data so we have the party denomination, as coded in the abbreviations table for the election and survey data.</p>
</section>
<section id="joining-abbrev_collect-and-election-data" class="level4">
<h4 class="anchored" data-anchor-id="joining-abbrev_collect-and-election-data">Joining abbrev_collect and election data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>election_data_clean <span class="ot">&lt;-</span> election_data_clean <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(abbrev_collect, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"party"</span> <span class="ot">=</span> <span class="st">"denominacion"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="joining-abbrev_collect-and-survey" class="level4">
<h4 class="anchored" data-anchor-id="joining-abbrev_collect-and-survey">Joining abbrev_collect and survey</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Joining the abbrev_collect table with the survey table and adding the abbreviations that are not in the abbrev table to the column: party_collect</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>survey_clean_collect<span class="ot">&lt;-</span>survey_clean <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(abbrev_collect, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"party"</span> <span class="ot">=</span> <span class="st">"siglas"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">party_collect =</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(party_collect <span class="sc">==</span> <span class="st">"PSOE"</span> <span class="sc">~</span> <span class="st">"PSOE"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"CS"</span> <span class="sc">~</span> <span class="st">"CS"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"UP_IU"</span> <span class="sc">~</span> <span class="st">"UP_IU"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"EH_BILDU"</span> <span class="sc">~</span> <span class="st">"EH_BILDU"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"PP"</span> <span class="sc">~</span> <span class="st">"PP"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"PNV"</span> <span class="sc">~</span><span class="st">"PNV"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"BNG"</span> <span class="sc">~</span> <span class="st">"BNG"</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"VOX"</span> <span class="sc">~</span> <span class="st">"VOX"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"MP"</span> <span class="sc">~</span> <span class="st">"MP"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"CP"</span> <span class="sc">~</span> <span class="st">"CP"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"ERC"</span> <span class="sc">~</span> <span class="st">"ERC"</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                     party_collect <span class="sc">==</span> <span class="st">"CU"</span> <span class="sc">~</span> <span class="st">"CU"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                     <span class="cn">TRUE</span> <span class="sc">~</span> party)) <span class="sc">|&gt;</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>party)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Reducing the data set by taking out unsuseful variables</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>survey_clean_collect_red <span class="ot">&lt;-</span> survey_clean_collect <span class="sc">|&gt;</span> </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>field_date_from, <span class="sc">-</span>field_date_to, <span class="sc">-</span>exit_poll) <span class="sc">|&gt;</span> </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(vote_int)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># removing siglas not to confuse with party_collect</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>abbrev_collect<span class="ot">&lt;-</span> abbrev_collect <span class="sc">|&gt;</span> </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>siglas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="questions" class="level2">
<h2 class="anchored" data-anchor-id="questions">Questions</h2>
<section id="q1-how-is-the-vote-of-national-parties-psoe-pp-vox-cs-mp-up---iu-distributed-against-regional-or-nationalist-parties" class="level3">
<h3 class="anchored" data-anchor-id="q1-how-is-the-vote-of-national-parties-psoe-pp-vox-cs-mp-up---iu-distributed-against-regional-or-nationalist-parties">Q1 How is the vote of national parties (PSOE, PP, VOX, CS, MP, UP - IU) distributed against regional or nationalist parties?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a> national_parties <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PSOE"</span>, <span class="st">"PP"</span>, <span class="st">"VOX"</span>, <span class="st">"CS"</span>, <span class="st">"MP"</span>, <span class="st">"UP_IU"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> regional_nationalist_parties <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"OTHER"</span>, <span class="st">"ERC"</span>, <span class="st">"CP"</span>, <span class="st">"BNG"</span>, <span class="st">"CU"</span>, <span class="st">"PNV"</span>, <span class="st">"EH_BILDU"</span> )</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#data set I need for my question</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>election_data_clean_1 <span class="ot">&lt;-</span>  election_data_clean <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>(anno<span class="sc">:</span>votos_candidaturas)) </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#slicing the sample to make the code and then will run it when its all done</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#election_data_sample &lt;- election_data_clean_1 |&gt; </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#slice_sample(prop =0.10)</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>election_data_q1 <span class="ot">&lt;-</span> election_data_clean_1 <span class="sc">|&gt;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec, party_collect) <span class="sc">|&gt;</span> </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">party_type =</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(party_collect <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PSOE"</span>, <span class="st">"PP"</span>, <span class="st">"VOX"</span>, <span class="st">"CS"</span>, <span class="st">"MP"</span>, <span class="st">"UP_IU"</span>) <span class="sc">~</span> <span class="st">"national"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"regional/nationalist"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum_votes =</span> <span class="fu">sum</span>(votes)) <span class="sc">|&gt;</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Summing the total votes per party per election</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>election_data_q1 <span class="ot">&lt;-</span> election_data_q1 <span class="sc">|&gt;</span> </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec, party_type) <span class="sc">|&gt;</span> </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">votes_elec_party =</span> <span class="fu">sum</span>(votes)) <span class="sc">|&gt;</span> </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Summing the total votes voted per election</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>election_data_q1 <span class="ot">&lt;-</span> election_data_q1 <span class="sc">|&gt;</span> </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(date_elec) <span class="sc">|&gt;</span> </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">votes_elec_total =</span> <span class="fu">sum</span>(votes)) <span class="sc">|&gt;</span> </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>()</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Computing a percentage of how many votes a party received compared to the total votes voted</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>election_data_q1 <span class="ot">&lt;-</span> election_data_q1 <span class="sc">|&gt;</span> </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">votes_elec_party_perc =</span> (votes_elec_party<span class="sc">/</span>votes_elec_total)<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">#creating new dataset to visualize the relationship between the share of national parties and regional/ nationalist parties</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>graph_data <span class="ot">&lt;-</span> election_data_q1 <span class="sc">|&gt;</span> </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec) <span class="sc">|&gt;</span> </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(party_type, votes_elec_party_perc) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> graph_data, <span class="fu">aes</span>(<span class="at">x =</span> date_elec, <span class="at">y =</span> votes_elec_party_perc, <span class="at">color =</span> party_type, <span class="at">group =</span> party_type)) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, votes_elec_party_perc)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Vote Share of National and Regional Parties</span><span class="sc">\n</span><span class="st">in Elections between 2008 and 2019"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date of Election"</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"1 year"</span>, <span class="at">date_labels =</span> <span class="st">"%Y"</span>)<span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot at the end shows the relationship of the share going to each group of parties. We see that in 2016 the share of votes going to national parties increased, while the opposite happened to regional and nationalist parties. Regional and nationalist parties recorded their highest share in the 2011 election.</p>
</section>
<section id="q2-which-party-was-the-winner-in-the-municipalities-with-more-than-100000-habitants-census-in-each-of-the-elections" class="level3">
<h3 class="anchored" data-anchor-id="q2-which-party-was-the-winner-in-the-municipalities-with-more-than-100000-habitants-census-in-each-of-the-elections">Q2 Which party was the winner in the municipalities with more than 100,000 habitants (census) in each of the elections?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>election_data_clean_2 <span class="ot">&lt;-</span>election_data_clean <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>(anno<span class="sc">:</span>vuelta)) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">codigo_ccaa_pro_muni =</span> <span class="fu">paste</span>(codigo_ccaa, codigo_provincia, codigo_municipio, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> <span class="co">#code to track each by municipality</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_votes_municipality =</span> votos_blancos<span class="sc">+</span> votos_nulos <span class="sc">+</span> votos_candidaturas) <span class="sc">|&gt;</span> <span class="co">#total votes casted in each municipality for every row</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec, codigo_ccaa_pro_muni) <span class="sc">|&gt;</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">votes_perc_party_municipality =</span> (votes<span class="sc">/</span>total_votes_municipality)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">|&gt;</span> <span class="co">#percentage of votes that a party got from the total amount of votes cast in each municipality</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a> q2_final_result <span class="ot">&lt;-</span> election_data_clean_2 <span class="sc">|&gt;</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(censo <span class="sc">&gt;</span> <span class="dv">100000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(date_elec, codigo_ccaa_pro_muni) <span class="sc">|&gt;</span> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(votes_perc_party_municipality)) <span class="sc">|&gt;</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(q2_final_result, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span>party_collect))<span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="at">fill =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(count)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Election Winners in Municipalities with more than 100,000 inhabitants in each election"</span>, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Party"</span>, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Party"</span>)) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>date_elec, <span class="at">scales =</span> <span class="st">"free_x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Interestingly, in election where the PP won, it also won the most populous municipalities after the party system shifted away from the traditional two-party system.</p>
</section>
<section id="q3-which-party-was-the-second-when-the-first-was-the-psoe-and-when-the-first-was-the-pp" class="level3">
<h3 class="anchored" data-anchor-id="q3-which-party-was-the-second-when-the-first-was-the-psoe-and-when-the-first-was-the-pp">Q3 Which party was the second when the first was the PSOE? And when the first was the PP?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>election_data_q3 <span class="ot">&lt;-</span> election_data_clean_2 <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cod_mun, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"codigo_ccaa_pro_muni"</span> <span class="ot">=</span> <span class="st">"cod_mun"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(censo <span class="sc">&gt;</span> <span class="dv">100000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date_elec, party, party_collect, codigo_ccaa_pro_muni, municipio, votes_perc_party_municipality) <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec, codigo_ccaa_pro_muni) <span class="sc">|&gt;</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(votes_perc_party_municipality)) <span class="sc">|&gt;</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify dates and municipalities where PSOE won</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>psoe_wins <span class="ot">&lt;-</span> election_data_q3 <span class="sc">|&gt;</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(party_collect <span class="sc">==</span> <span class="st">"PSOE"</span>, rank <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date_elec, codigo_ccaa_pro_muni)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a> <span class="co"># Filter for municipalities where PSOE won and find the parties coming in second place</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>parties_2nd_place_after_PSOE <span class="ot">&lt;-</span> election_data_q3 <span class="sc">|&gt;</span> </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(psoe_wins, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date_elec"</span>, <span class="st">"codigo_ccaa_pro_muni"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rank <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date_elec, municipio, party, party_collect) </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify dates and municipalities where PP won</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>PP_wins <span class="ot">&lt;-</span> election_data_q3 <span class="sc">|&gt;</span> </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(party_collect <span class="sc">==</span> <span class="st">"PP"</span>, rank <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date_elec, codigo_ccaa_pro_muni)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a> <span class="co"># Filter for municipalities where PP won and find the parties coming in second place</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>parties_2nd_place_after_PP <span class="ot">&lt;-</span> election_data_q3 <span class="sc">|&gt;</span> </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(PP_wins, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date_elec"</span>, <span class="st">"codigo_ccaa_pro_muni"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rank <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date_elec, municipio, party, party_collect)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This barplot illustrates the second place finisher for municipalities where the PSOE won.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(parties_2nd_place_after_PSOE, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span>party_collect))<span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="at">fill =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(count)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Second placed parties if PSOE wins a municipality"</span>, </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Party"</span>, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Party"</span>)) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This barplot illustrates the second place finisher for municipalities where the PP won.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(parties_2nd_place_after_PP, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span>party_collect))<span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="at">fill =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(count)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Second placed parties if PP wins a municipality"</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Party"</span>, </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Party"</span>)) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We now only read out the party that has come in second the most often when the PSOE has won using the glue package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>second_place_party_PSOE <span class="ot">&lt;-</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  parties_2nd_place_after_PSOE <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(party_collect, <span class="at">name =</span> <span class="st">"Party_Count"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Party_Count <span class="sc">==</span> <span class="fu">max</span>(Party_Count)) <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(party_collect)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>PSOE <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"The party that has come in 2nd most often when the PSOE has won a municipality is {second_place_party_PSOE}."</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the outcome</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(PSOE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The party that has come in 2nd most often when the PSOE has won a municipality is PP.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>second_place_party_PP <span class="ot">&lt;-</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  parties_2nd_place_after_PP <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(party_collect, <span class="at">name =</span> <span class="st">"Party_Count"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Party_Count <span class="sc">==</span> <span class="fu">max</span>(Party_Count)) <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(party_collect)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>PP <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"The party that has come in 2nd most often when the PP has won a municipality is {second_place_party_PP}."</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the outcome</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(PP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The party that has come in 2nd most often when the PP has won a municipality is PSOE.</code></pre>
</div>
</div>
</section>
<section id="q4-who-benefits-from-low-turnout" class="level3">
<h3 class="anchored" data-anchor-id="q4-who-benefits-from-low-turnout">Q4 Who benefits from low turnout?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create turnout column</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>election_data_turnout <span class="ot">&lt;-</span> election_data_clean <span class="sc">|&gt;</span>  </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">municipio_id =</span> <span class="fu">paste</span>(codigo_provincia, codigo_municipio, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(municipio_id, date_elec) <span class="sc">|&gt;</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnout_pcg =</span> <span class="fu">round</span>((((votos_candidaturas<span class="sc">+</span>votos_nulos<span class="sc">+</span>votos_blancos)<span class="sc">/</span>censo)<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(municipio_id) <span class="sc">|&gt;</span>  </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vote_share =</span> (votes <span class="sc">/</span> (votos_candidaturas <span class="sc">+</span> votos_blancos))<span class="sc">*</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Low turnout dataset</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>low_turnout_winners <span class="ot">&lt;-</span> election_data_turnout <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(turnout_pcg <span class="sc">&lt;</span> <span class="dv">60</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, vote_share, <span class="at">by =</span> <span class="fu">c</span>(municipio_id)) <span class="sc">|&gt;</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vote_share, party, party_collect)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(low_turnout_winners, <span class="fu">aes</span>(<span class="at">x =</span> party_collect)) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"count"</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(count)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of Municipalities Won by Party in Low Turnout Elections"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Low turnout defined as any election with a turnout less than 60% "</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Party"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">55000</span>, <span class="at">by =</span> <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Historically, since 2008, in low turnout elections, smaller parties have had a higher chance of winning the election. Nonetheless, the PP dominates these low turnout elections, with the PSOE considerably lagging behind. This can be attributed to the more consistent electorate of the conservative PP casting votes more reliable.</p>
</section>
<section id="q5-how-to-analyze-the-relationship-between-census-and-vote-is-it-true-that-certain-parties-win-in-rural-areas" class="level3">
<h3 class="anchored" data-anchor-id="q5-how-to-analyze-the-relationship-between-census-and-vote-is-it-true-that-certain-parties-win-in-rural-areas">Q5 How to analyze the relationship between census and vote? Is it true that certain parties win in rural areas?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subset with rural municipalities and their winners</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>election_winners_rural<span class="ot">&lt;-</span> election_data_clean <span class="sc">|&gt;</span>  </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(censo <span class="sc">&lt;</span> <span class="dv">30000</span>, votes <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">municipio_id =</span> <span class="fu">paste</span>(codigo_provincia, codigo_municipio, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec, municipio_id) <span class="sc">|&gt;</span>  </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vote_share =</span> (votes <span class="sc">/</span> (votos_candidaturas <span class="sc">+</span> votos_blancos))<span class="sc">*</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, vote_share, <span class="at">by =</span> <span class="fu">c</span>(municipio_id)) <span class="sc">|&gt;</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vote_share, party, party_collect)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the count of each party winning rural areas</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(election_winners_rural, <span class="fu">aes</span>(<span class="at">x =</span> party_collect)) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"count"</span>) <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"count"</span>, <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(count)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Winning Parties in Rural Areas"</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Rural area defined as municipality with less than 30,000 inhabitants"</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Party"</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As may be expected, the PP is most successful in elections in rural areas.</p>
</section>
<section id="q6-how-to-calibrate-the-error-of-the-polls-remember-that-the-polls-are-voting-intentions-at-national-level" class="level3">
<h3 class="anchored" data-anchor-id="q6-how-to-calibrate-the-error-of-the-polls-remember-that-the-polls-are-voting-intentions-at-national-level">Q6 How to calibrate the error of the polls (remember that the polls are voting intentions at national level)?</h3>
<p>Creating an ID in both the survey data table and the election data table to match the two.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>survey_clean_collect_red <span class="ot">&lt;-</span> survey_clean_collect_red <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_join =</span> <span class="fu">paste</span>(<span class="fu">substr</span>(date_elec, <span class="dv">1</span>, <span class="dv">7</span>), party_collect, <span class="at">sep =</span> <span class="st">"-"</span>)) </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>election_data_clean <span class="ot">&lt;-</span> election_data_clean <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_join =</span> <span class="fu">paste</span>(<span class="fu">substr</span>(date_elec, <span class="dv">1</span>, <span class="dv">7</span>), party_collect, <span class="at">sep =</span> <span class="st">"-"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Following, the average difference between percentage of votes gained and voting intentions per election is calculated. For that the survey data set and election data set are merged.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>election_data_clean_red <span class="ot">&lt;-</span> election_data_clean <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>anno, <span class="sc">-</span>mes, <span class="sc">-</span>vuelta,<span class="sc">-</span>participacion_1, <span class="sc">-</span>participacion_2, <span class="sc">-</span>votos_candidaturas) <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">codigo_ccaa_pro_muni =</span> <span class="fu">paste</span>(codigo_ccaa, codigo_provincia, codigo_municipio, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(date_elec) <span class="sc">&gt;=</span> <span class="dv">2018</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Summing the total votes per party per election</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>election_data_clean_red<span class="ot">&lt;-</span>election_data_clean_red <span class="sc">|&gt;</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec, party_collect) <span class="sc">|&gt;</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">votes_elec_party =</span> <span class="fu">sum</span>(votes)) <span class="sc">|&gt;</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Summing the total votes voted per election </span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>election_data_clean_red<span class="ot">&lt;-</span>election_data_clean_red <span class="sc">|&gt;</span> </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(codigo_ccaa_pro_muni, date_elec) <span class="sc">|&gt;</span> </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">votes_total_blancos_nulos =</span> votos_blancos <span class="sc">+</span> votos_nulos) <span class="sc">|&gt;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(date_elec) <span class="sc">|&gt;</span> </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">votes_total_blancos_nulos =</span> <span class="fu">sum</span> (votes_total_blancos_nulos)) <span class="sc">|&gt;</span> </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">votes_elec =</span> <span class="fu">sum</span>(votes)) <span class="sc">|&gt;</span> </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">votes_elec_total =</span> votes_total_blancos_nulos <span class="sc">+</span> votes_elec)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Computing a percentage of how many votes a party received compared to the total votes voted</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>election_data_clean_red<span class="ot">&lt;-</span>election_data_clean_red <span class="sc">|&gt;</span> </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">votes_elec_party_perc =</span> (votes_elec_party<span class="sc">/</span>votes_elec_total)<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>election_data_clean_red_7 <span class="ot">&lt;-</span> election_data_clean_red <span class="sc">|&gt;</span> </span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_join, votes_elec_total, codigo_ccaa, date_elec, votes_elec_party_perc, party_collect) <span class="sc">|&gt;</span> </span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id_join, date_elec, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>survey_clean_collect_red_7 <span class="ot">&lt;-</span> survey_clean_collect_red <span class="sc">|&gt;</span> </span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_join, vote_int, id_pollster)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Joining survey_clean with election_data_clean using the id_join from both tables</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>survey_elec <span class="ot">&lt;-</span> election_data_clean_red_7 <span class="sc">|&gt;</span> </span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(survey_clean_collect_red_7, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id_join"</span> <span class="ot">=</span> <span class="st">"id_join"</span>), <span class="at">relationship =</span> <span class="st">"many-to-many"</span>) </span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="co">#subtracting the voting intentions (in percentage) of the percenatage of votes gained per per party per election. </span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="co">#As the difference can be both positive and negative, the differences in votes are squared to account for the negatives</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>survey_elec<span class="ot">&lt;-</span>survey_elec <span class="sc">|&gt;</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_vote_int =</span> votes_elec_party_perc <span class="sc">-</span> vote_int) <span class="sc">|&gt;</span> </span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_vote_int_2 =</span>diff_vote_int<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating the average difference between percentage of votes gained and voting intentions per election</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="co">#Taking the squareroot to return the variable in to the orginal units</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>survey_elec<span class="ot">&lt;-</span>survey_elec <span class="sc">|&gt;</span> </span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(date_elec) <span class="sc">|&gt;</span> </span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">avg_diff_vote_int =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(diff_vote_int_2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="q7-in-which-election-were-the-polls-most-wrong" class="level3">
<h3 class="anchored" data-anchor-id="q7-in-which-election-were-the-polls-most-wrong">Q7 In which election were the polls most wrong?</h3>
<p>Using the previously calculated difference between votes gained and intentions to vote, a distinct function is applied</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking in which election the polls were most wrong </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>survey_elec_result<span class="ot">&lt;-</span> survey_elec <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">distinct</span>(avg_diff_vote_int, date_elec)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>survey_elec_result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  avg_diff_vote_int date_elec 
              &lt;dbl&gt; &lt;date&gt;    
1              9.10 2019-04-01
2              8.88 2019-11-01</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>survey_elec_result<span class="ot">&lt;-</span> survey_elec_result <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_elec_factor =</span> <span class="fu">as.character</span>(date_elec))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(survey_elec_result, <span class="fu">aes</span>(<span class="at">x =</span> date_elec_factor, <span class="at">y =</span> avg_diff_vote_int)) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Error in election polls per election"</span>, </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Election"</span>, </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average Difference votes and votes intentions"</span>) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The polls of the election in April 2019 were slightly more mistaken than in the November election.</p>
</section>
<section id="q8-how-were-the-polls-wrong-in-national-parties-psoe-pp-vox-cs-mp-up---iu" class="level3">
<h3 class="anchored" data-anchor-id="q8-how-were-the-polls-wrong-in-national-parties-psoe-pp-vox-cs-mp-up---iu">Q8 How were the polls wrong in national parties (PSOE, PP, VOX, CS, MP, UP - IU)?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Computing the average polling error per party per election</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>survey_elec_national<span class="ot">&lt;-</span>survey_elec <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(party_collect <span class="sc">==</span> <span class="st">"PSOE"</span><span class="sc">|</span>party_collect <span class="sc">==</span> <span class="st">"PP"</span><span class="sc">|</span>party_collect <span class="sc">==</span><span class="st">"VOX"</span><span class="sc">|</span>party_collect <span class="sc">==</span><span class="st">"CS "</span><span class="sc">|</span>party_collect <span class="sc">==</span><span class="st">"MP"</span><span class="sc">|</span>party_collect <span class="sc">==</span><span class="st">"UP_IU"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec, party_collect) <span class="sc">|&gt;</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">avg_diff_poll =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(diff_vote_int_2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) ) <span class="sc">|&gt;</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Obtaining the results</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>survey_elec_national<span class="ot">&lt;-</span>survey_elec_national <span class="sc">|&gt;</span> </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(avg_diff_poll, date_elec, party_collect) <span class="sc">|&gt;</span> </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date_elec)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>survey_elec_national<span class="ot">&lt;-</span>survey_elec_national <span class="sc">|&gt;</span> </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_elec_factor =</span> <span class="fu">as.character</span>(date_elec))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(survey_elec_national, <span class="fu">aes</span>(<span class="at">x =</span> party_collect, <span class="at">y =</span> avg_diff_poll, <span class="at">fill =</span> date_elec_factor)) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Error in election polls per party"</span>, </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Party"</span>, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average Difference votes and votes intentions"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Election"</span>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The polling error are largest in both elections for the party PSOE and smallest for the party UP_IU. The polling errors per party are highly similar for both elections.</p>
</section>
<section id="q9-which-polling-houses-got-it-right-the-most-and-which-ones-deviated-the-most-from-the-results" class="level3">
<h3 class="anchored" data-anchor-id="q9-which-polling-houses-got-it-right-the-most-and-which-ones-deviated-the-most-from-the-results">Q9 Which polling houses got it right the most and which ones deviated the most from the results?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Computing the average polling error per polling house per election and obtaining the minimum and maxium polling with their corresonding pollhouses per election</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>survey_elec<span class="ot">&lt;-</span>survey_elec <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_pollster, date_elec) <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">avg_diff_pollhouse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(diff_vote_int_2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(avg_diff_pollhouse)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Obtaining the result for the maximum polling error</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>result_max<span class="ot">&lt;-</span>survey_elec<span class="sc">|&gt;</span> </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec) <span class="sc">|&gt;</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(avg_diff_pollhouse <span class="sc">==</span> <span class="fu">max</span>(avg_diff_pollhouse)) <span class="sc">|&gt;</span> </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(avg_diff_pollhouse, id_pollster, date_elec) </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>result_max</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
# Groups:   date_elec [2]
  avg_diff_pollhouse id_pollster date_elec 
               &lt;dbl&gt; &lt;chr&gt;       &lt;date&gt;    
1               9.74 pollster-49 2019-04-01
2              10.0  pollster-76 2019-11-01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Obtaining the result for the maximum polling error</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>result_min<span class="ot">&lt;-</span>survey_elec<span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(avg_diff_pollhouse <span class="sc">==</span> <span class="fu">min</span>(avg_diff_pollhouse)) <span class="sc">|&gt;</span> </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(avg_diff_pollhouse, id_pollster, date_elec) </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>result_min</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
# Groups:   date_elec [2]
  avg_diff_pollhouse id_pollster date_elec 
               &lt;dbl&gt; &lt;chr&gt;       &lt;date&gt;    
1               8.72 pollster-56 2019-04-01
2               8.42 pollster-49 2019-11-01</code></pre>
</div>
</div>
<p>The polling houses in the results_max table are the polling houses with the minimum polling error for the elections of April and November and the results_min table, the polling houses with the smallest error for these two elections.</p>
</section>
</section>
<section id="additional-insights" class="level2">
<h2 class="anchored" data-anchor-id="additional-insights">Additional insights</h2>
<section id="how-did-the-voter-turnout-change-in-the-two-elections-in-2019" class="level3">
<h3 class="anchored" data-anchor-id="how-did-the-voter-turnout-change-in-the-two-elections-in-2019">How did the voter turnout change in the two elections in 2019?</h3>
<p>Following, a graph will display the change in voter turnout across the two elections with a so-called lollipop graph. Differences are calculated and plotted per community and across the whole of Spain.</p>
<p>The subsequent chunk creates a joint data for the two elections in 2019 of voter turnout in the communities and the whole of Spain.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Voter turnout regions</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>election_data_clean_lollipop <span class="ot">&lt;-</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  election_data_clean <span class="sc">|&gt;</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date_elec <span class="sc">&gt;=</span> <span class="st">"2019-04-01"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">votes_casted =</span> votos_candidaturas <span class="sc">+</span> votos_blancos <span class="sc">+</span> votos_nulos) <span class="sc">|&gt;</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>votos_blancos, <span class="sc">-</span>votos_candidaturas, <span class="sc">-</span>votos_nulos) <span class="sc">|&gt;</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">municipio_id =</span> <span class="fu">paste</span>(codigo_provincia, codigo_municipio, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(municipio_id, mes, <span class="at">.keep_all =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(municipio_id, codigo_ccaa, votes_casted, censo, mes) <span class="sc">|&gt;</span> </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(codigo_ccaa, mes) <span class="sc">|&gt;</span> </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">votes_sum =</span> <span class="fu">sum</span>(votes_casted),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">population_sum =</span> <span class="fu">sum</span>(censo) ) <span class="sc">|&gt;</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">voter_turnout =</span> (votes_sum <span class="sc">/</span> population_sum) <span class="sc">*</span> <span class="dv">100</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'codigo_ccaa'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Voter turnout Spain</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>election_data_clean_lollipop_avg <span class="ot">&lt;-</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  election_data_clean <span class="sc">|&gt;</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date_elec <span class="sc">&gt;=</span> <span class="st">"2019-04-01"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">votes_casted =</span> votos_candidaturas <span class="sc">+</span> votos_blancos <span class="sc">+</span> votos_nulos) <span class="sc">|&gt;</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>votos_blancos, <span class="sc">-</span>votos_candidaturas, <span class="sc">-</span>votos_nulos) <span class="sc">|&gt;</span> </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">municipio_id =</span> <span class="fu">paste</span>(codigo_provincia, codigo_municipio, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(municipio_id, mes, <span class="at">.keep_all =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(municipio_id, codigo_ccaa, votes_casted, censo, mes) <span class="sc">|&gt;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mes) <span class="sc">|&gt;</span> </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">votes_sum =</span> <span class="fu">sum</span>(votes_casted),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">population_sum =</span> <span class="fu">sum</span>(censo) ) <span class="sc">|&gt;</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">voter_turnout =</span> (votes_sum <span class="sc">/</span> population_sum) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>election_data_clean_lollipop_avg<span class="sc">$</span>codigo_ccaa <span class="ot">&lt;-</span> <span class="st">"00"</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>election_data_clean_lollipop <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(election_data_clean_lollipop, election_data_clean_lollipop_avg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The delineating the communities is factorised using forcats so it orders the community according to their voter turnout. The results are pulled into a string, which then supplies the information on the order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ordering codigo variable for subsequent plot</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>max_turnout_mes04 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mes <span class="sc">==</span> <span class="st">"04"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(codigo_ccaa) <span class="sc">|&gt;</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">max_turnout =</span> <span class="fu">max</span>(voter_turnout)) <span class="sc">|&gt;</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Order codigo_ccaa based on max_turnout_mes11</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>order_by_max_turnout <span class="ot">&lt;-</span> max_turnout_mes04 <span class="sc">|&gt;</span> </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(max_turnout) <span class="sc">|&gt;</span> </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(codigo_ccaa)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the order to the codigo_ccaa factor</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>election_data_clean_lollipop<span class="sc">$</span>codigo_ccaa <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  election_data_clean_lollipop<span class="sc">$</span>codigo_ccaa,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> order_by_max_turnout</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To connect the dots delineating the voter turnout data frames for each difference is calculated, as well as the numerical values of the differences. Then the graph is created.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for segments</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>data_00 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"00"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>data_01 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"01"</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>data_02 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"02"</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>data_03 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"03"</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>data_04 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"04"</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>data_05 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"05"</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>data_06 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"06"</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>data_07 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"07"</span>)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>data_08 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"08"</span>)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>data_09 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"09"</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>data_10 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"10"</span>)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>data_11 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"11"</span>)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>data_12 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"12"</span>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>data_13 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"13"</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>data_14 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"14"</span>)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>data_15 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"15"</span>)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>data_16 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"16"</span>)</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>data_17 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"17"</span>)</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>data_18 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"18"</span>)</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>data_19 <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(codigo_ccaa <span class="sc">==</span> <span class="st">"19"</span>)</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="co"># creating </span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>election_data_clean_lollipop_dif <span class="ot">&lt;-</span> election_data_clean_lollipop <span class="sc">|&gt;</span> </span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(codigo_ccaa) <span class="sc">|&gt;</span> </span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">difference =</span> voter_turnout <span class="sc">-</span> <span class="fu">lag</span>(voter_turnout, <span class="at">default =</span> voter_turnout[<span class="dv">1</span>])) <span class="sc">|&gt;</span> </span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mes <span class="sc">==</span> <span class="st">"11"</span>)</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(election_data_clean_lollipop, <span class="fu">aes</span>(<span class="at">x =</span> voter_turnout, <span class="at">y =</span> codigo_ccaa, <span class="at">group=</span> mes), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> mes)) <span class="sc">+</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Difference in Voter Turnout</span><span class="sc">\n</span><span class="st">by Region (April vs. November 2019)"</span>,</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">col=</span> <span class="fu">guide_legend</span>(<span class="at">title=</span> <span class="st">"Election"</span>)) <span class="sc">+</span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"April 2019"</span>, <span class="st">"November 2019"</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>),</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="cn">NA</span>),</span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">45</span>, <span class="dv">80</span>, <span class="at">by =</span> <span class="dv">5</span>),) <span class="sc">+</span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_segment</span>(<span class="at">data =</span> data_00, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_01, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_02, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_03, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_segment</span>(<span class="at">data =</span> data_04, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_05, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_06, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_07, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_segment</span>(<span class="at">data =</span> data_08, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_09, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_10, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_11, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_segment</span>(<span class="at">data =</span> data_12, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_13, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_14, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_15, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_segment</span>(<span class="at">data =</span> data_16, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_17, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_18, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data_19, <span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">max</span>(voter_turnout), <span class="at">yend =</span> codigo_ccaa), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> election_data_clean_lollipop_dif,</span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.2f%%"</span>, difference),</span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> voter_turnout, </span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> codigo_ccaa),</span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="fl">0.4</span>,</span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="fl">1.1</span>,</span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"00"</span> <span class="ot">=</span> <span class="st">"Average in Spain"</span>,</span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"01"</span><span class="ot">=</span><span class="st">"Andalucia"</span>,</span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"02"</span><span class="ot">=</span><span class="st">"Aragon"</span>,</span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"03"</span><span class="ot">=</span><span class="st">"Asturias"</span>,</span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"04"</span><span class="ot">=</span><span class="st">"Baleares"</span>,</span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"05"</span><span class="ot">=</span><span class="st">"Cantabria"</span>,</span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"06"</span><span class="ot">=</span><span class="st">"Castilla La Mancha"</span>,</span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"07"</span><span class="ot">=</span><span class="st">"Castilla Leon"</span>,</span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"08"</span><span class="ot">=</span><span class="st">"Cataluna"</span>,</span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"09"</span><span class="ot">=</span><span class="st">"Canarias"</span>,</span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"10"</span><span class="ot">=</span><span class="st">"Extremadura"</span>,</span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"11"</span><span class="ot">=</span><span class="st">"Galicia"</span>,</span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"12"</span><span class="ot">=</span><span class="st">"Madrid"</span>,</span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"13"</span><span class="ot">=</span><span class="st">"Murcia"</span>,</span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"14"</span><span class="ot">=</span><span class="st">"Navarra"</span>,</span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"15"</span><span class="ot">=</span><span class="st">"Comunidad Valenciana"</span>,</span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"16"</span><span class="ot">=</span><span class="st">"Pais Vasco"</span>,</span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"17"</span><span class="ot">=</span><span class="st">"La Rioja"</span>,</span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"18"</span><span class="ot">=</span><span class="st">"Ceuta"</span>,</span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"19"</span><span class="ot">=</span><span class="st">"Melilla"</span>)) <span class="sc">+</span> </span>
<span id="cb37-112"><a href="#cb37-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="sc">-</span><span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/Lollipop%20graph-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="who-won-which-municipality-and-how-did-it-change-over-the-years" class="level3">
<h3 class="anchored" data-anchor-id="who-won-which-municipality-and-how-did-it-change-over-the-years">Who won which municipality and how did it change over the years?</h3>
<p>To answer this question, several maps are created illustrating the winner of each municipality.</p>
<section id="election-winners-in-november-2019" class="level4">
<h4 class="anchored" data-anchor-id="election-winners-in-november-2019">Election Winners in November 2019</h4>
<p>To start off, we take a look at the most recent election represented in the data frame.</p>
<p>First, the data of election winners is extracted. Using the package mapSpain, this data frame is joined to a data frame containing geospatial information. Subsquently, the map is plotted.</p>
<p>We can see that the conservative PP was able, despite defeat to reasonably well defend its strongholds in the north, while the social democratic PSOE swept across the South.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>election_data_clean_red_winner_2019_b <span class="ot">&lt;-</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  election_data_clean <span class="sc">|&gt;</span>  </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>anno, <span class="sc">-</span>mes, <span class="sc">-</span>vuelta,<span class="sc">-</span>participacion_1, <span class="sc">-</span>participacion_2, <span class="sc">-</span>votos_nulos) <span class="sc">|&gt;</span>  </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date_elec <span class="sc">==</span> <span class="st">"2019-11-01"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(votes) <span class="sc">|&gt;</span>  </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">municipio_id =</span> <span class="fu">paste</span>(codigo_provincia, codigo_municipio, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec, municipio_id) <span class="sc">|&gt;</span>  </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vote_share =</span> (votes <span class="sc">/</span> (votos_candidaturas <span class="sc">+</span> votos_blancos))<span class="sc">*</span><span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, vote_share, <span class="at">by =</span> <span class="fu">c</span>(municipio_id)) <span class="sc">|&gt;</span>  </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(municipio_id, vote_share, party_collect, party)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>esp_can <span class="ot">&lt;-</span> <span class="fu">esp_get_country</span>() </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>can_prov <span class="ot">&lt;-</span> <span class="fu">esp_get_can_provinces</span>()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>can_box <span class="ot">&lt;-</span> <span class="fu">esp_get_can_box</span>() </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>munic <span class="ot">&lt;-</span> <span class="fu">esp_get_munic</span>() </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># creating province_municipality code  </span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>munic <span class="ot">&lt;-</span>    </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  munic <span class="sc">|&gt;</span>  </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">municipio_id =</span> <span class="fu">paste</span>(cpro, cmun, <span class="at">sep =</span> <span class="st">"-"</span>)) </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># merging based on province_municipality code  </span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>elec_winner_munic_2019b <span class="ot">&lt;-</span> munic <span class="sc">|&gt;</span> </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(election_data_clean_red_winner_2019_b, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"municipio_id"</span> <span class="ot">=</span> <span class="st">"municipio_id"</span>))  </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2019 a election winners map </span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co"># party colors</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>party_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"UP_IU"</span><span class="ot">=</span><span class="st">"#8968CD"</span>,  </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"PSOE"</span><span class="ot">=</span><span class="st">"#CD2626"</span>,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"PP"</span><span class="ot">=</span><span class="st">"#0055A4"</span>, </span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"VOX"</span><span class="ot">=</span><span class="st">"#5ABF35"</span>, </span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"BAI"</span><span class="ot">=</span><span class="st">"#EECFA1"</span>,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"OTHER"</span> <span class="ot">=</span> <span class="st">"#999999"</span>, </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"PNV"</span> <span class="ot">=</span> <span class="st">"#008341"</span>, </span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"EH_BILDU"</span> <span class="ot">=</span> <span class="st">"#00D0B6"</span>, </span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"CS"</span> <span class="ot">=</span> <span class="st">"#FF5001"</span>,      </span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"ERC"</span> <span class="ot">=</span> <span class="st">"#F0D85D"</span>,    </span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"BNG"</span> <span class="ot">=</span> <span class="st">"#77B4E0"</span>,  </span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"MP"</span> <span class="ot">=</span> <span class="st">"#02988B"</span>) </span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(esp_can) <span class="sc">+</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> can_prov) <span class="sc">+</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> can_box) <span class="sc">+</span> </span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> elec_winner_munic_2019b, <span class="fu">aes</span>(<span class="at">fill =</span> party_collect), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Party"</span>, <span class="at">values =</span> party_colors) <span class="sc">+</span> </span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span>  </span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span><span class="st">" Election Winners by Municipality in November 2019"</span>) <span class="sc">+</span>  </span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.18</span>, <span class="fl">0.55</span>),    </span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="st">"center"</span>,   </span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NULL</span>, <span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>))<span class="sc">+</span> </span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="all-elections-since-2008" class="level4">
<h4 class="anchored" data-anchor-id="all-elections-since-2008">All elections since 2008</h4>
<p>Now, a plot mapping the winners in all municiaplities in all elections since 2008 is shown by using a facet wrap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>election_winners <span class="ot">&lt;-</span>   </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  election_data_clean <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>mes, <span class="sc">-</span>vuelta,<span class="sc">-</span>participacion_1, <span class="sc">-</span>participacion_2, <span class="sc">-</span>votos_nulos) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(votes) <span class="sc">|&gt;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">municipio_id =</span> <span class="fu">paste</span>(codigo_provincia, codigo_municipio, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec, municipio_id) <span class="sc">|&gt;</span> </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vote_share =</span> (votes <span class="sc">/</span> (votos_candidaturas <span class="sc">+</span> votos_blancos))<span class="sc">*</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, vote_share, <span class="at">by =</span> <span class="fu">c</span>(municipio_id, date_elec)) <span class="sc">|&gt;</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(municipio_id, vote_share, party_collect, party, anno, date_elec) </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>elec_winners_all_time <span class="ot">&lt;-</span> munic <span class="sc">|&gt;</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(election_winners, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"municipio_id"</span> <span class="ot">=</span> <span class="st">"municipio_id"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>election_names <span class="ot">&lt;-</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_labeller</span>(<span class="fu">c</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2008-03-01'</span><span class="ot">=</span><span class="st">"March 2008"</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2011-11-01'</span><span class="ot">=</span><span class="st">"November 2011"</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2015-12-01'</span><span class="ot">=</span><span class="st">"December 2015"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2016-06-01'</span><span class="ot">=</span><span class="st">"June 2016"</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2019-04-01'</span><span class="ot">=</span><span class="st">"April 2019"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2019-11-01'</span><span class="ot">=</span><span class="st">"November 2019"</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    ))  </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(esp_can) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> can_prov) <span class="sc">+</span> </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> can_box) <span class="sc">+</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> elec_winners_all_time, <span class="fu">aes</span>(<span class="at">fill =</span> party_collect), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Party"</span>, <span class="at">values =</span> party_colors) <span class="sc">+</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span><span class="st">" Election Winners by Municipality since 2008"</span>) <span class="sc">+</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>))<span class="sc">+</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>date_elec, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(election_names))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="the-2019-elections" class="level4">
<h4 class="anchored" data-anchor-id="the-2019-elections">The 2019 Elections</h4>
<p>Finally, we return to the two elections in 2019 to see how the short amount of time in between elections influenced the results across municipalities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>election_winners_2019 <span class="ot">&lt;-</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  election_data_clean <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(anno <span class="sc">==</span> <span class="st">"2019"</span>)<span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>mes, <span class="sc">-</span>vuelta,<span class="sc">-</span>participacion_1, <span class="sc">-</span>participacion_2, <span class="sc">-</span>votos_nulos) <span class="sc">|&gt;</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(votes) <span class="sc">|&gt;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">municipio_id =</span> <span class="fu">paste</span>(codigo_provincia, codigo_municipio, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec, municipio_id) <span class="sc">|&gt;</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vote_share =</span> (votes <span class="sc">/</span> (votos_candidaturas <span class="sc">+</span> votos_blancos))<span class="sc">*</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, vote_share, <span class="at">by =</span> <span class="fu">c</span>(municipio_id, date_elec)) <span class="sc">|&gt;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(municipio_id, vote_share, party_collect, party, anno, date_elec)  </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>elec_winners_2019 <span class="ot">&lt;-</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  munic <span class="sc">|&gt;</span> </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(election_winners_2019, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"municipio_id"</span> <span class="ot">=</span> <span class="st">"municipio_id"</span>)) </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>election_names <span class="ot">&lt;-</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">'2019-04-01'</span><span class="ot">=</span><span class="st">"April 2019"</span>,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">'2019-11-01'</span><span class="ot">=</span><span class="st">"November 2019"</span> </span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  )) </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(esp_can) <span class="sc">+</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span> </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> can_prov) <span class="sc">+</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> can_box) <span class="sc">+</span> </span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> elec_winners_2019, <span class="fu">aes</span>(<span class="at">fill =</span> party_collect), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Party"</span>, <span class="at">values =</span> party_colors) <span class="sc">+</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span><span class="st">" Election Winners by Municipality in 2019 elections"</span>) <span class="sc">+</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>), </span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="st">"center"</span>)<span class="sc">+</span> </span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span> </span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>date_elec, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(election_names))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="from-a-two-party-system-to-a-multi-party-system" class="level3">
<h3 class="anchored" data-anchor-id="from-a-two-party-system-to-a-multi-party-system">From a two-party system to a multi-party system</h3>
<p>In this section, we show the change of the Spanish party system, from a system dominated by two parties to a multi-party system. We show this by creating a slopegraph, indicating the vote share of every major party in every election since 2008.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>election_data_mika <span class="ot">&lt;-</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  election_data_clean <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(party_collect, votes, date_elec)) </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>election_data_mika<span class="sc">$</span>party_collect<span class="ot">&lt;-</span> </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(election_data_mika<span class="sc">$</span>party_collect)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>election_data_mika<span class="ot">&lt;-</span> election_data_mika <span class="sc">|&gt;</span> </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date_elec) <span class="sc">|&gt;</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TOTALvotos_poreleccion =</span> <span class="fu">sum</span>(votes))<span class="sc">|&gt;</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">|&gt;</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">votos_partidos =</span> <span class="fu">sum</span>(votes),</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> <span class="fu">c</span>(party_collect, </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>                    date_elec, </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>                    TOTALvotos_poreleccion)) <span class="sc">|&gt;</span> </span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>election_data_mika<span class="ot">&lt;-</span> election_data_mika <span class="sc">|&gt;</span> </span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"vote_share"</span> <span class="ot">=</span> <span class="fu">round</span>( votos_partidos<span class="sc">/</span>TOTALvotos_poreleccion<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>)) </span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>election_data_mika <span class="ot">&lt;-</span> election_data_mika <span class="sc">|&gt;</span> </span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">convocatorias =</span> <span class="fu">format_ISO8601</span>(date_elec, </span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">precision =</span> <span class="st">"ym"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">newggslopegraph</span>(<span class="at">dataframe =</span> election_data_mika,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">Times =</span> convocatorias,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">Measurement =</span> vote_share,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">Grouping =</span> party_collect,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">Title =</span> <span class="st">"Vote Distribution"</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">SubTitle =</span> <span class="st">"Percentage share of votes per party for elections from 2008 to 2019"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">LineColor =</span> party_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
You gave me 12 colors I'm recycling colors because you have 13 party_collects</code></pre>
</div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="who-uses-which-polling-provider" class="level3">
<h3 class="anchored" data-anchor-id="who-uses-which-polling-provider">Who uses which polling provider?</h3>
<p>With our final question we wanted to know which media outlet uses which polling station. To visualize this, we create a network pitting collaborators visually against each other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>survey_data_mika <span class="ot">&lt;-</span> survey_clean <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(date_elec, pollster, media) <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date_elec)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>network<span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(survey_data_mika, <span class="at">directed =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in graph_from_data_frame(survey_data_mika, directed = F): In `d' `NA'
elements were replaced with string "NA"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>deg <span class="ot">&lt;-</span> <span class="fu">degree</span>(network, <span class="at">mode=</span><span class="st">"all"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(network, </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Pollster &amp; Media network"</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">layout=</span> layout_nicely,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.size=</span>deg<span class="sc">*</span><span class="dv">9</span>,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.color =</span> <span class="st">"black"</span>, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.cex =</span> <span class="fl">0.6</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">vertex.label.degree =</span> <span class="sc">-</span>pi<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.arrow.size =</span> <span class="dv">0</span>, </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.arrow.width =</span> <span class="dv">0</span>, </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">edge.color =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="group_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>